<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
<title>SNIPER ENGINE ‚Äî MT5 REAL (ANDROID SAFE)</title>

<script src="https://unpkg.com/lightweight-charts@4.1.1/dist/lightweight-charts.standalone.production.js"></script>

<style>
*{box-sizing:border-box}
body{margin:0;background:#000;color:#0f0;font-family:Courier New,monospace;overflow:hidden}
#top{position:fixed;top:0;left:0;right:0;z-index:10;background:#111;border-bottom:2px solid #0f0;padding:6px;display:grid;grid-template-columns:1fr 1fr}
.badge{border:1px solid #0f0;padding:6px;font-size:11px;text-align:center;font-weight:900}
#banner{position:fixed;top:46px;left:0;right:0;display:block;padding:10px;text-align:center;font-weight:900;background:#222}
#charts{position:absolute;top:90px;left:0;right:0;bottom:0;display:grid;grid-template-rows:1fr 1fr}
.chart{border-bottom:1px solid #222}
</style>
</head>

<body>

<div id="top">
  <div class="badge">BTCUSD ‚Ä¢ MT5 REAL</div>
  <div class="badge">MODE: GALAK + SAFETY</div>
</div>

<div id="banner">‚è≥ WAITING MT5 FEED‚Ä¶</div>

<div id="charts">
  <div id="c1" class="chart"></div>
  <div id="c5" class="chart"></div>
</div>

<script>
// ================= CONFIG =================
const WS_URL = "wss://YOUR-WORKER.workers.dev"; // GANTI INI
const SPEED_TH = 0.0006;
const DELTA_TH = 0.03;
const COOLDOWN = 3500;
const QUIET_RATIO = 0.45;

let lastAlert=0;
let lastPrice={ '1m':null,'5m':null };
let avgRange={ '1m':0,'5m':0 };

// ================= CHART INIT =================
const c1 = LightweightCharts.createChart(document.getElementById('c1'), {
  layout:{background:{color:'#000'},textColor:'#0f0'},
  timeScale:{timeVisible:true,secondsVisible:true}
});
const s1 = c1.addCandlestickSeries();

const c5 = LightweightCharts.createChart(document.getElementById('c5'), {
  layout:{background:{color:'#000'},textColor:'#0f0'},
  timeScale:{timeVisible:true,secondsVisible:true}
});
const s5 = c5.addCandlestickSeries();

// ===== ANDROID FIX =====
function forceResize(){
  c1.timeScale().fitContent();
  c5.timeScale().fitContent();
}
setTimeout(forceResize,300);
setTimeout(forceResize,1200);

// ===== SEED DATA (ANTI BLANK) =====
function seed(series){
  const t=Math.floor(Date.now()/1000);
  series.setData([{time:t-60,open:1,high:1,low:1,close:1}]);
}
seed(s1); seed(s5);

// ================= WS =================
const banner=document.getElementById("banner");
const ws = new WebSocket(WS_URL);

ws.onopen=()=>banner.innerText="‚úÖ MT5 FEED CONNECTED";
ws.onerror=()=>banner.innerText="‚ùå WS ERROR";
ws.onclose=()=>banner.innerText="‚ùå WS CLOSED";

ws.onmessage=e=>{
  const d=JSON.parse(e.data);
  feed("1m",d.m1,s1);
  feed("5m",d.m5,s5);
};

// ================= ENGINE =================
function feed(tf,c,series){
  if(!c) return;
  const t=Math.floor(Date.now()/1000);
  series.update({time:t,open:c.o,high:c.h,low:c.l,close:c.c});

  const body=Math.abs(c.c-c.o);
  const range=c.h-c.l;
  avgRange[tf]=avgRange[tf]*0.9+range*0.1;

  if(avgRange[tf]>0 && range<avgRange[tf]*QUIET_RATIO) return;

  const delta=((c.c-c.o)/c.o)*100;
  const now=Date.now();
  if(now-lastAlert<COOLDOWN) return;

  if(lastPrice[tf]!==null){
    const speed=Math.abs(c.c-lastPrice[tf]);
    if(speed>c.o*SPEED_TH){
      banner.innerText=`üî• ${tf} SPEED BURST`;
      lastAlert=now;
    }
  }
  lastPrice[tf]=c.c;

  if(Math.abs(delta)>DELTA_TH){
    banner.innerText=`‚ö° ${tf} PRESSURE ${delta>0?'BULL':'BEAR'}`;
    lastAlert=now;
  }

  if((c.h-Math.max(c.o,c.c))>body*1.8){
    banner.innerText=`‚ö†Ô∏è ${tf} LIQUIDITY ABOVE TAKEN`;
    lastAlert=now;
  }
  if((Math.min(c.o,c.c)-c.l)>body*1.8){
    banner.innerText=`‚ö†Ô∏è ${tf} LIQUIDITY BELOW TAKEN`;
    lastAlert=now;
  }
}
</script>
</body>
</html>
