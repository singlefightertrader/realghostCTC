<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>BTCUSDT Â· LEVEL DEWA ENGINE</title>

<script src="https://unpkg.com/lightweight-charts@4.1.1/dist/lightweight-charts.standalone.production.js"></script>

<style>
body{margin:0;background:#000;color:#0f0;font-family:Courier New,monospace}
#header{padding:8px;text-align:center;font-weight:900;border-bottom:2px solid #0f0}
#chart{height:60vh}
#status{
  padding:10px;
  text-align:center;
  font-weight:900;
  font-size:15px;
}
#mission{
  padding:8px;
  text-align:center;
  font-weight:900;
  color:#00ff99;
}
</style>
</head>

<body>

<div id="header">BTCUSDT Â· STORY + MISSION (LEVEL DEWA)</div>
<div id="chart"></div>
<div id="status">CONNECTING...</div>
<div id="mission"></div>

<script>
// ========== CONFIG ==========
const WS_URL = "wss://btusdmt5.sapammeded.workers.dev";
// ============================

// === CHART SETUP ===
const chart = LightweightCharts.createChart(
  document.getElementById('chart'),
  {
    layout:{background:{color:'#000'},textColor:'#0f0'},
    grid:{vertLines:{color:'#222'},horzLines:{color:'#222'}},
    timeScale:{timeVisible:true,secondsVisible:false}
  }
);

const candleSeries = chart.addCandlestickSeries({
  upColor:'#00ff66',
  downColor:'#ff4444',
  borderUpColor:'#00ff66',
  borderDownColor:'#ff4444',
  wickUpColor:'#00ff66',
  wickDownColor:'#ff4444'
});

// === MISSION LINES ===
let missionLine = null;
function drawMission(price){
  if(missionLine) candleSeries.removePriceLine(missionLine);
  missionLine = candleSeries.createPriceLine({
    price: price,
    color: '#00ff99',
    lineWidth: 2,
    lineStyle: 2,
    axisLabelVisible: true,
    title: 'MISSION'
  });
}

// === STATUS ===
const statusBox = document.getElementById("status");
const missionBox = document.getElementById("mission");

// === WS CONNECT ===
const ws = new WebSocket(WS_URL);

ws.onopen = () => {
  statusBox.innerText = "BACKEND CONNECTED â€“ STORY ENGINE ACTIVE";
};

ws.onmessage = e => {
  const d = JSON.parse(e.data);

  // candle update
  if(d.candle){
    candleSeries.update({
      time: d.candle.time,
      open: d.candle.open,
      high: d.candle.high,
      low: d.candle.low,
      close: d.candle.close
    });
  }

  // status
  if(d.status){
    statusBox.innerText = d.message || d.status;
  }

  // mission
  if(d.mission_price){
    drawMission(d.mission_price);
    missionBox.innerText = "ðŸŽ¯ MISI HARGA: " + d.mission_price;
  }
};
</script>

</body>
</html>
